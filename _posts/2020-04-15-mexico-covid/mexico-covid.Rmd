---
title: "Ociosidad en tiempos de COVID-19 (2019-nCoV)"
author:
- affiliation: UHN, Toronto, ON, Canada
  affiliation_url: https://thebru.ca/Juan_Pablo_Diaz_Martinez
  name: Juan Pablo Díaz-Martínez
date: "`r Sys.Date()`"
base_url: https://juandiazmart.github.io/blog/
description: Algunos comentarios de lo que pasa en México con respecto a esta enfermedad.
slug: COVID19Mexico
creative_commons: CC BY-SA
categories:
  - R
  - "COVID-19"
output:
  distill::distill_article:
    self_contained: no
    toc: yes
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      tidy.opts=list(width.cutoff=60),
                      tidy=TRUE)
library(tidyverse)
library(lubridate)
library(countrycode)
library(ggrepel)
library(prismatic)
library(ggsci)
library(paletteer)
library(distcrete)
library(magrittr)
library(rstan)
library(data.table)
library(gdata)
library(EnvStats)
library(matrixStats)
library(scales)
library(gridExtra)
library(ggpubr)
library(bayesplot)
library(cowplot)
library(plotly)

#source('Mexico_muerte.R', encoding = 'UTF-8')

percent <- function(x, digits = 2, format = "f", ...) {
  paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
pop<-127091642
countries<-c("ITA","ESP","USA")
confirmed_raw <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv", col_types = cols())
deaths_raw <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv", col_types = cols())
confirmed_data<-confirmed_raw %>%
  select(-Lat, -Long) %>%
  rename(country = `Country/Region`,Province_Re=`Province/State`) %>%
  mutate(iso3c = countrycode(country,
                             origin = "country.name",
                             destination = "iso3c")) %>%
  select(-country) %>%
  filter(iso3c %in% countries) %>% 
  pivot_longer(
    c(-Province_Re,-iso3c), 
    names_to = "date_str", 
    values_to = "confirmed"
  ) %>%
  mutate(date = mdy(date_str)) %>%
  group_by(Province_Re)  %>% 
  mutate(new_confirmed=c(0,diff(confirmed)))  %>% ungroup() %>%
  select(iso3c,Province_Re, date,confirmed,new_confirmed) 
deaths_data<-deaths_raw %>%
  select(-Lat, -Long) %>%
  rename(country = `Country/Region`,Province_Re=`Province/State`) %>%
  mutate(iso3c = countrycode(country,
                             origin = "country.name",
                             destination = "iso3c")) %>%
  select(-country) %>%
  filter(iso3c %in% countries) %>% 
  pivot_longer(
    c(-Province_Re,-iso3c), 
    names_to = "date_str", 
    values_to = "deaths"
  ) %>%
  mutate(date = mdy(date_str)) %>%
  group_by(Province_Re)  %>% 
  mutate(new_deaths=c(0,diff(deaths)))  %>% ungroup() %>%
  select(iso3c,Province_Re, date,deaths,new_deaths) 
### mexico
muertes_mx <- 
  read_csv("https://raw.githubusercontent.com/mariorz/covid19-mx-time-series/master/data/covid19_deaths_mx.csv") %>% 
  pivot_longer(-Estado, names_to = "date", values_to = "deaths") %>% 
  mutate(date = dmy(date)) %>% rename(iso3c=Estado) %>% 
  group_by(iso3c)  %>% 
  mutate(new_deaths=c(0,diff(deaths)))  %>% ungroup() %>%
  select(iso3c, date,deaths,new_deaths) 
confirmados_mx <- 
  read_csv("https://raw.githubusercontent.com/mariorz/covid19-mx-time-series/master/data/covid19_confirmed_mx.csv") %>% 
  pivot_longer(-Estado, names_to = "date", values_to = "confirmed") %>% 
  mutate(date = dmy(date)) %>% rename(iso3c=Estado) %>% 
  group_by(iso3c)  %>% 
  mutate(new_confirmed=c(0,diff(confirmed)))  %>% ungroup() %>%
  select(iso3c, date,confirmed,new_confirmed) 
estados <- confirmados_mx %>%
  full_join(muertes_mx, by = c("iso3c", "date"))
mexico<-estados %>% 
  group_by(date) %>%
  summarise_at(vars(-iso3c),funs(sum)) %>% mutate(iso3c="MEX") %>% bind_rows(estados)
data_covid <- confirmed_data %>%
  full_join(deaths_data, by = c("iso3c","Province_Re", "date")) %>% bind_rows(mexico) 
countries<-c("ITA","ESP","USA","MEX")
source("utils/geom-stepribbon.r")
#---------------------------------------------------------------------------
load(paste0('results/',"base",'-',Sys.Date(),'-stanfit.Rdata'))
  
data_interventions <- read.csv("interventions.csv", 
                                 stringsAsFactors = FALSE)
covariates <- data_interventions[1, c(1,2,3,4,5,6, 7, 8)]
  
N <- length(dates[[1]])
N2 <- N + 7
country <- "MEX"


estimated_deaths_forecast <- cumsum(colQuantiles(estimated.deaths[,1:N2,1], probs=.5)[N:N2])
estimated_deaths_li_forecast <- cumsum(colQuantiles(estimated.deaths[,1:N2,1], probs=.025)[N:N2])
estimated_deaths_ui_forecast <- cumsum(colQuantiles(estimated.deaths[,1:N2,1], probs=.975)[N:N2])
    
estimated_deaths_cf <- cumsum(colQuantiles(estimated.deaths.cf[,1:N2,1], probs=.5))
estimated_deaths_li_cf <- cumsum(colQuantiles(estimated.deaths.cf[,1:N2,1], probs=.025))
estimated_deaths_ui_cf <- cumsum(colQuantiles(estimated.deaths.cf[,1:N2,1], probs=.975))
    
predicted_cases <- colQuantiles(prediction[,1:N,1], probs=.5)
predicted_cases_li <- colQuantiles(prediction[,1:N,1], probs=.025)
predicted_cases_ui <- colQuantiles(prediction[,1:N,1], probs=.975)
predicted_cases_li2 <- colQuantiles(prediction[,1:N,1], probs=.25)
predicted_cases_ui2 <- colQuantiles(prediction[,1:N,1], probs=.75)
    
    
estimated_deaths <- colQuantiles(estimated.deaths[,1:N,1], probs=.5)
estimated_deaths_li <- colQuantiles(estimated.deaths[,1:N,1], probs=.025)
estimated_deaths_ui <- colQuantiles(estimated.deaths[,1:N,1], probs=.975)
estimated_deaths_li2 <- colQuantiles(estimated.deaths[,1:N,1], probs=.25)
estimated_deaths_ui2 <- colQuantiles(estimated.deaths[,1:N,1], probs=.75)
    
rt <- colQuantiles(out$Rt[,1:N,1],probs=.5)
rt_li <- colQuantiles(out$Rt[,1:N,1],probs=.025)
rt_ui <- colQuantiles(out$Rt[,1:N,1],probs=.975)
rt_li2 <- colQuantiles(out$Rt[,1:N,1],probs=.25)
rt_ui2 <- colQuantiles(out$Rt[,1:N,1],probs=.75)
    
covariates_country <- covariates[which(covariates$ï..Country == country), 2:8]   
    
covariates_country$lockdown = NULL
covariates_country$sport = NULL 
covariates_country$travel_restrictions = NULL 
covariates_country_long <- gather(covariates_country[], key = "key", 
                                      value = "value")
covariates_country_long$x <- rep(NULL, length(covariates_country_long$key))
un_dates <- unique(covariates_country_long$value)
    
    for (k in 1:length(un_dates)){
      idxs <- which(covariates_country_long$value == un_dates[k])
      max_val <- round(max(rt_ui)) + 0.3
      for (j in idxs){
        covariates_country_long$x[j] <- max_val
        max_val <- max_val - 0.3
      }
    }
    
    
    covariates_country_long$value <- mdy(covariates_country_long$value) 
    covariates_country_long$country <- rep(country, 
                                           length(covariates_country_long$value))
    
    data_country <- data.frame("time" = as_date(as.character(dates[[1]])),
                               "country" = rep(country, length(dates[[1]])),
                               "reported_cases" = reported_cases[[1]], 
                               "reported_cases_c" = cumsum(reported_cases[[1]]), 
                               "predicted_cases_c" = cumsum(predicted_cases),
                               "predicted_min_c" = cumsum(predicted_cases_li),
                               "predicted_max_c" = cumsum(predicted_cases_ui),
                               "predicted_min_c2" = cumsum(predicted_cases_li2),
                               "predicted_max_c2" = cumsum(predicted_cases_ui2),
                               "predicted_cases" = predicted_cases,
                               "predicted_min" = predicted_cases_li,
                               "predicted_max" = predicted_cases_ui,
                               "predicted_min2" = predicted_cases_li2,
                               "predicted_max2" = predicted_cases_ui2,
                               "deaths" = deaths_by_country[[1]],
                               "deaths_c" = cumsum(deaths_by_country[[1]]),
                               "estimated_deaths_c" =  cumsum(estimated_deaths),
                               "death_min_c" = cumsum(estimated_deaths_li),
                               "death_max_c"= cumsum(estimated_deaths_ui),
                               "death_min_c2" = cumsum(estimated_deaths_li2),
                               "death_max_c2"= cumsum(estimated_deaths_ui2),
                               "estimated_deaths" = estimated_deaths,
                               "death_min" = estimated_deaths_li,
                               "death_max"= estimated_deaths_ui,
                               "death_min2" = estimated_deaths_li2,
                               "death_max2"= estimated_deaths_ui2,
                               "rt" = rt,
                               "rt_min" = rt_li,
                               "rt_max" = rt_ui,
                               "rt_min2" = rt_li2,
                               "rt_max2" = rt_ui2)
  data_cases_95 <- data.frame(data_country$time, data_country$predicted_min_c, 
                              data_country$predicted_max_c)
  names(data_cases_95) <- c("time", "cases_min", "cases_max")
  data_cases_95$key <- rep("nintyfive", length(data_cases_95$time))
  data_cases_50 <- data.frame(data_country$time, data_country$predicted_min_c2, 
                              data_country$predicted_max_c2)
  names(data_cases_50) <- c("time", "cases_min", "cases_max")
  data_cases_50$key <- rep("fifty", length(data_cases_50$time))
  data_cases <- rbind(data_cases_95, data_cases_50)
  levels(data_cases$key) <- c("ninetyfive", "fifty")
  
  p1 <- ggplot(data_country) +
    geom_bar(data = data_country, aes(x = time, y = reported_cases_c,fill = "Observados"), 
            stat='identity', alpha=0.5) + 
    geom_ribbon(data = data_cases_95, 
                aes(x = time, ymin = cases_min, ymax = cases_max, fill = "95% CrI")) +
    geom_line(aes(x=time,y=predicted_cases_c,color="Predicción"))+
    xlab("") +
    ylab("Número acumulado de casos confirmados") +
    scale_y_continuous(labels = scales::comma_format(accuracy = 1),n.breaks = 10)+
    scale_x_date(date_breaks = "3 days", labels = date_format("%e %b")) + 
    scale_fill_manual(name = "", labels = c("Observados","95% CrI"),
                      values = c(alpha("deepskyblue4", 0.35),alpha("coral4", 0.5))) + 
    scale_color_manual(name = "",
                      values ="black") + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1),legend.position="bottom") + 
    guides(fill=guide_legend(ncol=1))
  
  data_deaths_95 <- data.frame(data_country$time, data_country$death_min_c, 
                               data_country$death_max_c)
  names(data_deaths_95) <- c("time", "death_min", "death_max")
  data_deaths_95$key <- rep("nintyfive", length(data_deaths_95$time))
  data_deaths_50 <- data.frame(data_country$time, data_country$death_min_c2, 
                               data_country$death_max_c2)
  names(data_deaths_50) <- c("time", "death_min", "death_max")
  data_deaths_50$key <- rep("fifty", length(data_deaths_50$time))
  data_deaths <- rbind(data_deaths_95, data_deaths_50)
  levels(data_deaths$key) <- c("ninetyfive", "fifty")
  
  
 times <- as_date(as.character(dates[[1]]))
    times_forecast <- times[length(times)] + 0:7
    data_country_forecast <- data.frame("time" = times_forecast,
                                        "country" = rep(country, 8),
                                        "estimated_deaths_forecast" = estimated_deaths_forecast+head(tail(data_country$estimated_deaths_c, n=2), n=1),
                                        "death_min_forecast" = estimated_deaths_li_forecast+head(tail(data_country$death_min_c, n=2), n=1),
                                        "death_max_forecast"= estimated_deaths_ui_forecast+head(tail(data_country$death_max_c, n=2), n=1))
    
   
    times_cf <- times[1] + 0:(N2-1)
    data_country_cf <- data.frame("time" = times_cf,
                                        "country" = rep(country, (N2)),
                                        "estimated_deaths_cf" = estimated_deaths_cf,
                                        "death_min_cf" = estimated_deaths_li_cf,
                                        "death_max_cf"= estimated_deaths_ui_cf)
    

  
  data_deaths <- data_country %>%
    select(time, deaths, estimated_deaths) %>%
    gather("key" = key, "value" = value, -time)
  
  data_deaths_forecast <- data_country_forecast %>%
    select(time, estimated_deaths_forecast) %>%
    gather("key" = key, "value" = value, -time)
  
  # Force less than 1 case to zero
  data_deaths$value[data_deaths$value < 1] <- NA
  data_deaths_forecast$value[data_deaths_forecast$value < 1] <- NA
  data_deaths_all <- rbind(data_deaths, data_deaths_forecast)
  
  p2 <- ggplot(data_country) +
    geom_bar(data = data_country, aes(x = time, y = deaths_c), 
             fill = "coral4", stat='identity', alpha=0.5) + 
    geom_line(data = data_country, aes(x = time, y = estimated_deaths_c), 
              col = "deepskyblue4") + 
    geom_line(data = data_country_forecast, 
              aes(x = time, y = estimated_deaths_forecast), 
              col = "deepskyblue4", alpha = 0.5) + 
    geom_line(data = data_country_cf, 
              aes(x = time, y = estimated_deaths_cf), 
              col = "red", alpha = 0.5)+
    geom_ribbon(data = data_country, aes(x = time, 
                                         ymin = death_min_c, 
                                         ymax = death_max_c),
                fill="deepskyblue4", alpha=0.3) +
    geom_ribbon(data = data_country_forecast, 
                aes(x = time, 
                    ymin = death_min_forecast, 
                    ymax = death_max_forecast),
                fill = "deepskyblue4", alpha=0.35) +
    geom_ribbon(data = data_country_cf, 
                aes(x = time, 
                    ymin = death_min_cf, 
                    ymax = death_max_cf),
                fill = "red", alpha=0.35)+
    geom_vline(xintercept = data_deaths$time[length(data_deaths$time)], 
               col = "black", linetype = "dashed", alpha = 0.5) + 
    scale_y_continuous(labels = scales::comma_format(accuracy = 1),n.breaks = 10,trans = "log10")+
    #scale_fill_manual(name = "", 
    #                 labels = c("Confirmed deaths", "Predicted deaths"),
    #                 values = c("coral4", "deepskyblue4")) + 
    xlab("") +
    ylab("Número acumulado de muertos (log10)") + 
    scale_x_date(date_breaks = "3 days", labels = date_format("%e %b"))  + 
    coord_cartesian(ylim = c(1, 100000), expand = FALSE) + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    guides(fill=guide_legend(ncol=1, reverse = TRUE))
  
    plot_labels <- c("Cancelación de eventos",
                   "Cierre de escuelas",
                   "Aislamiento después de presentar síntomas",
                   "Distanciamiento Social")
  
  # Plotting interventions
  data_rt_95 <- data.frame(data_country$time, 
                           data_country$rt_min, data_country$rt_max)
  names(data_rt_95) <- c("time", "rt_min", "rt_max")
  data_rt_95$key <- rep("nintyfive", length(data_rt_95$time))
  data_rt_50 <- data.frame(data_country$time, data_country$rt_min2, 
                           data_country$rt_max2)
  names(data_rt_50) <- c("time", "rt_min", "rt_max")
  data_rt_50$key <- rep("fifty", length(data_rt_50$time))
  data_rt <- rbind(data_rt_95, data_rt_50)
  levels(data_rt$key) <- c("ninetyfive", "fifth")
  
  p3 <- ggplot(data_country) +
    geom_stepribbon(data = data_rt_95, aes(x = time, ymin = rt_min, ymax = rt_max, 
                                        group = key,
                                        fill = key)) +
    geom_hline(yintercept = 1, color = 'black', size = 0.1) + 
    geom_step(aes(x=time,y=rt,linetype="Predicción"))+
    scale_linetype_manual(name = "",
                       values ="solid")+
    geom_segment(data = covariates_country_long,
                 aes(x = value, y = 0, xend = value, yend = max(x)), 
                 linetype = "dashed", colour = "black", alpha = 0.75) +
    geom_point(data = covariates_country_long, aes(x = value, 
                                                   y = x, 
                                                   group = key, 
                                                   shape = key, 
                                                   col = key), size = 4) +
    xlab("") +
    scale_y_continuous(n.breaks = 10)+
    ylab("Número efectivo de reproducción") +
    scale_fill_manual(name = "", labels = c("95% CrI"),
                      values = c(alpha("deepskyblue4", 0.35))) + 
    scale_shape_manual(name = "Intervenciones", labels = plot_labels,
                       values = c(21, 22, 23, 24, 25, 12)) + 
    scale_colour_discrete(name = "Intervenciones", labels = plot_labels) + 
    scale_x_date(date_breaks = "3 days", labels = date_format("%e %b"), 
                 limits = c(data_country$time[1], 
                            data_country$time[length(data_country$time)])) + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1),legend.position="bottom")+
    guides(shape=guide_legend(ncol=1,nrow=4))
  
  confirmados<-as.numeric(mexico %>% filter(iso3c=="MEX") %>% summarise(max=max(confirmed)))
  muertes<-as.numeric(mexico %>% filter(iso3c=="MEX") %>% summarise(max=max(deaths)))
  
  muertes_cf<-as.numeric(data_country_cf %>% filter(time==Sys.Date()) %>% select(estimated_deaths_cf,death_min_cf,death_max_cf))
  muertes_pred<-as.numeric(data_country_forecast %>% filter(time==Sys.Date()) %>% select(estimated_deaths_forecast,death_min_forecast,death_max_forecast))
  muertes_evitadas<-muertes_cf-muertes_pred
  
  
```
# Resumen ejecutivo

Los [coronavirus](https://coronavirus.gob.mx/informacion-accesible/) son una familia de virus que suelen causar enfermedades en animales, aunque algunos pueden afectar también a humanos. En las personas pueden producir infecciones respiratorias que pueden ir desde un resfriado común hasta enfermedades más graves. En el 80% de los casos, la infección por este nuevo coronavirus, denominado oficialmente SARS-Cov-2, produce síntomas respiratorios de carácter leve. Con el nombre de COVID-19 se denomina la enfermedad respiratoria producida por este virus. Hasta el día de hoy (`r format(max(data_covid$date), "%b %e")`) se han confirmado en nuestro país `r formatC(confirmados, format="f", big.mark=",", digits=0)` casos y `r formatC(muertes, format="f", big.mark=",", digits=0)`muertes. Mucho se ha hablado de la importancia del distanciamiento social ya que, de no hacerlo, se traduciría en hospitales saturados y tristemente en un gran número de muertes.

Debido a la importancia de lo anterior, decidí escribir este post con los siguientes objetivos:

1. Resumir la situación de la epidemia por COVID-19 en nuestro país, tomando en cuenta el funcionamiento del sistema de vigilancia epidemiológico en nuestro país.
2. Estimar el impacto que han tenido las diferentes medidas de mitigación realizadas por el gobierno federal a través de las muertes observadas por COVID-19 en nuestro país mediante un modelo jerárquico bayesiano propuesto [aquí](https://www.imperial.ac.uk/mrc-global-infectious-disease-analysis/covid-19/report-13-europe-npi-impact/): Este modelo también estimó que tan rápido se infectan las personas (número efectivo de reproducción) y el total de pacientes infectados con SARS-COV2 a través del tiempo. Dado que el modelo estima el efecto que han tenido las medidas decretadas por el gobierno federal, fue posible predecir el número de muertes acumuladas que pueden ocurrir en los siguientes 7 días. 

Los resultados son los siguientes: el `r percent(tail(data_country[,"predicted_cases_c"],1)/pop)` (95% CrI: `r paste(percent(tail(data_country[,"predicted_min_c"],1)/pop),"-",percent(tail(data_country[,"predicted_max_c"],1)/pop))`) de la población en nuestro país se encuentra infectada con SARS-COV2 hasta `r format(max(data_covid$date), "%b %e")`. Desde que se exhortó al distanciamiento social mediante la campaña "Susana Distancia", el número de reprodución efectivo esperado fue de `r formatC(tail(data_country[,"rt"],1), format="f", big.mark=",", digits=1)` (95% CrI: `r paste(formatC(tail(data_country[,"rt_min"],1), format="f", big.mark=",", digits=1),"-",formatC(tail(data_country[,"rt_max"],1), format="f", big.mark=",", digits=1))`), lo que implica que una persona infecta a `r formatC(tail(data_country[,"rt"],1), format="f", big.mark=",", digits=1)` personas. 

De acuerdo a los resultados, el número acumulado de muertes seguirá incrementando en los próximos 7 días. Si bien se observó que "Susana Distancia" ha logrado reducir el número de muertes, estas medida de mitigación no ha logrado disminuir lo suficiente el número efectivo de reproducción^[Lo ideal es que éste se encuentre debajo de uno]. Estas estimaciones son de gran utilidad ya que podrán servir para poder realizar estimaciones del uso de recursos por tratar COVID-19, especialmente sería de gran interés poder conocer si el número de ventiladores serán suficientes en los siguientes meses.

## Introducción

Este post nace despúes de 4 semanas de distanciamento social en Toronto, Canadá. Para los que no me conocen, actualmente soy doctorante en la Universidad de Toronto donde mi línea de investigación es el aprendizaje estadístico como herramienta de predicción en enfermedades que tienden a progresar a a través del tiempo (e.g. cáncer). Cuento con una posición de investigador asociado en [University Health Network](https://www.uhn.ca/corporate/AboutUHN) el cual aglomera diferentes hospitales para una mejor colabaración en diferentes temas de investigación.

Es importante notar que este post no ha sido revisado por pares y que mi línea de investigación no es el modelaje de enfermedades infecciosas. Lo que sí he hecho es apoyar a un grupo de investigadores en la provincia de Ontaro en Canadá en la creación de modelo para simular la utilización de [recursos](https://www.covid-19-mc.ca/about) en hospitales por COVID-19.
Este post tiene como objetivo discutir algunos aspectos importantes de la epidemia en nuestro país y por estimar el impacto de las diferentes medidas de mitigación en nuestro país utilizando el número de muertes como nuestra variable observable. El link para el código de este post se encuentre en un repositorio de Github el cuál podrán encontrar al final de este post; las gráficas y el análisis fueron hechos en `R`, utilizando en su mayoría librerías como `dplyr`, `ggplot2`,`rstan` entre otras.

# Epidemia en México

Mucho se ha hablado en las conferencias vespertinas relacionadas a COVID-19 acerca del número de casos nuevos desde que la epidemia llegó a nuestro país y si el gobierno ha hecho pruebas suficientes. Antes de cualquer análisis de la epidemia en México creo que es importante describir algunos aspectos importantes de ésta, como por ejemplo:
1. Cómo funciona el sistema epidemiológico en nuestro país.
2. Cómo se alimenta diariamente el número de casos confirmados.

## Sistema epidemiológico en México

El Dr. Hugo López Gatell ha mencionado en reiteradas ocasiones como funciona el sistema centinela en nuestro país (la siguiente [entrevista](https://elpais.com/sociedad/2020-03-26/lopez-gatell-en-mexico-queremos-un-balance-entre-proteger-la-salud-y-a-las-economias-mas-debilitadas.html) es muestra de lo anterior). A manera de resumen, la idea del programa es que “en vez de recopilar grandes cantidades de datos de calidad deficiente, hay que concentrarse en recopilar datos de buena calidad de un número reducido de centros centinela seleccionados cuidadosamente”, de acuerdo al documento de la [OMS](https://www.paho.org/revelac-i/wp-content/uploads/2015/10/2015-cha-guia-operativa-vigilancia-centinela-irag.pdf) actualizado en 2014. El proceso es buscar COVID-19 en pacientes negativos a la prueba de influenza para ver si hay transmisión comunitaria; Alberto Díaz Cayeros hace una descripción de éste y discute posibles fallas que pueden ocurrir al utilizar este [sistema](https://medium.com/@adiazcayeros/the-balancing-act-in-mexicos-covid-19-response-a6955ec629fc).

La vigilancia centinela no es nueva en nuestro país ya que éste fue utlizado para H1N1 en el 2009. ¿Por qué utilizar este sistema y no pruebas masivas como lo hizo Corea del Sur? Creo que es por dos razones: el sistema ha funcionado (H1N1) y es eficiente debido las limitaciones de recursos en salud en nuestro país. Es importante aclarar que estas limitaciones no son nuevas y es producto de un porcentaje muy bajo del gasto en el sector salud como porcentaje del PIB durante varios años de acuerdo a la [OCDE](https://stats.oecd.org/).



## Casos confirmados

El 28 de febrero fue confirmado el primer paciente con COVID-19 en nuestro país. Desde el 23 de marzo se han [modificado](https://lopezdoriga.com/nacional/modifica-salud-criterios-para-identificacion-de-casos-sospechosos-por-covid-19/) los criterios operacionales para la vigilancia epidemiológica de COVID-19. Como se ha mencionado en diferentes medio de comunicación (nota [aquí](https://www.elfinanciero.com.mx/nacional/al-10-de-los-casos-sospechosos-de-covid-19-con-sintomas-leves-se-les-aplica-prueba-imss)) la definición es la siguiente:

* Caso sospechoso - Persona de cualquier edad que en los últimos siete días haya presentado al menos dos síntomas de tos, fiebre o cefalea, es decir, dolor de cabeza intenso y persistente y que esté acompañado de los siguientes signos: dificultad para respirar, hinchazón en articulaciones con dificultad de movimiento, dolor muscular, ardor de garganta, rinorrea, conjuntivitis y dolor de tórax.

* Caso confirmado - Persona que cumpla lo anterior y que cuente con confirmación del InDRE.

Asimismo, se modificó el porcentaje de muestreo para vigilar los casos de COVID-19. Solo se realizará la prueba al 10% de los casos sospechosos sin síntomas o síntomas leves. A su vez, se realizará la prueba al 100% de los casos sospechosos con sintomología grave o que cumplan con la definición infección respiratoria aguda grave (IRAG). Es importante recalcar que el gobierno ha recalcado que **todos los casos sospechosos sin importar si se les realizó la prueba deberán de permanecer en aislamiento **.

Hace aproximadamente una semana el Dr. López Gatell mencionó que habían hasta **26 mil** [**casos**](https://lopezdoriga.com/nacional/lopez-gatell-estima-en-26-mil-519-los-casos-de-covid-19-en-mexico/) en nuestro país. Esta estimación se logró gracias a la vigilancia centinela ya que este sistema representa una muestra del total de unidades de salud en nuestro país^[El muestreo estadístico se encarga de seleccionar metodológicamente una muestra para poder hacer estimaciones a nivel poblacional.]

# Análisis de la epidemia en México
Antes de presentar datos y gráficas me gustaría enfatizar en **2 aspectos importantes al considerar la presentación y análisis de datos de casos confirmados con COVID-19**:

1. La comparación entre países (e.g. incidencia acumulada) debe de realizarse con mucho cuidado. Esto debido a lo expuesto en la sección anterior; los países tienen distintos sistemas epidemiológicos y diferentes recursos, por lo tanto la cantidad de casos confirmados está en función de la cantidad de pruebas que puedan realizar. Es muy importante recalcar esto ya que esta comparación es la que más noticias engañosas y falsas que al menos yo he encontrado en redes sociales (ver [aquí](https://twitter.com/samuel_garcias/status/1243696094682456068)).
2. La comparación entre países debe de realizarze desde un punto en común en el tiempo ya que la epidemia entra a cada país en momentos distintos. Esto tiene mucha importancia sobre todo al presentar gráficas e ilustraciones ya sea para mostrar la incidencia (casos nuevos) o incidencia acumulada.

¿Qué sí podemos rescatar cuando comparamos casos confirmados entre diferentes países?. La siguiente gráfica muestra el número de casos confirmados acumulados con COVID-19 desde que se comfirmó el paciente número 100. Decidí transformar el eje de las $y$ al aplicarle el logaritmo base 2; esta transformación ayuda a una mejor interpretación de los datos ya que es más fácil para el lector ver cuanto tiempo se tarda un país en tener el doble de casos confirmados en un periodo determinado de tiempo. Asimismo al transformar los datos la serie de tiempo presenta un comportamiento más lneal.

```{r acum_casos, message=FALSE, warning=FALSE, tidy=TRUE,fig.width=12, fig.height=8}
 data_covid  %>% filter(iso3c %in% countries) %>%
   group_by(iso3c,date) %>% summarise_at(vars(-Province_Re),funs(sum)) %>%
  filter(confirmed > 99) %>%
   mutate(days_elapsed = date - min(date),
          end_label = ifelse(date == max(date),iso3c, NA)) %>%
   ggplot(mapping = aes(x = days_elapsed, y = confirmed,label=end_label,
                        color = iso3c, alpha=iso3c,
                        group = iso3c)) + 
   geom_line(size = 0.8) +scale_alpha_manual(values=c(1,1,1,1,1,1,1,0.3,1))+
   geom_text_repel(nudge_x = 1.1,
                   nudge_y = 0.1, 
                   segment.color = NA) + 
   guides(color = FALSE,alpha=F) + 
   scale_color_manual(values = prismatic::clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)) +
   scale_y_continuous(labels = scales::comma_format(accuracy = 1),
                      trans = "log2",n.breaks = 10) +  
   scale_x_continuous(n.breaks = 10) +
   labs(x = "Días desde el caso número 100", 
        y = "Número acumulado de casos confirmados (escala log2)", 
        title = "Número acumulado de casos confirmados por COVID-19", 
        caption = "Juan Pablo Díaz @juandiazmart / Data: Repo John H.",
        subtitle = paste("Datos hasta", format(max(data_covid$date), "%b %e, %Y"))) + 
   theme(plot.title = element_text(size = rel(2), face = "bold"),
         plot.subtitle = element_text(size = rel(1.5)),
         axis.text.y = element_text(size = rel(2)),
         axis.title.x = element_text(size = rel(1.5)),
         axis.title.y = element_text(size = rel(1.5)),
         axis.text.x = element_text(size = rel(2)),
         legend.text = element_text(size = rel(2)),
         panel.grid.major = element_line(colour = "grey90", size = .1),
         panel.background = element_blank(),
         axis.line = element_line(colour = "grey50", size = .9)) + 
   geom_abline(intercept =log2(118), slope = 1/7,linetype = "dashed")+
   annotate("text", label = "Casos incrementan \n al doble cada 7 días", x = 23, y = 1700,size=3)+
   geom_abline(intercept =log2(118), slope = 1/3,linetype = "dashed")+
   annotate("text", label = "Casos incrementan \n al doble cada 3 días", x = 21, y = 32000,size=3)
```

México desde que llegó el caso número 100 ha tenido un incremento al doble de casos confirmados cada 3 días, con una ligera pendiente menor después de 5 días desde que llegó a su caso 100. Al final es esta pendiente la que queremos que se haga 0, es decir, aplastarla para que la curva de casos acumulados se "aplane". Si queremos comparar países no nos fijemos en el número de casos acumulados. Fijémonos mejor en sus pendientes y como éstas cambian a través del tiempo. Si los procedimientos epidemiológicos descritos anterormente no cambian, la pendiente de México podría incrementar si por ejemplo aumentan considerablemente los casos graves.

Dado que es difícil comparar casos confirmados por todo lo explicado en párrafos previos, pienso que es más fácil comparar el número de muertes^[Recordemos que a todos los graves sí se les realiza la prueba]. La siguiente gráfica nos ayuda a entender el comportamiento de número de muertes acumuladas en nuestro país desde que se presentó la quinta muerta.

```{r acum_muerte, message=FALSE, warning=FALSE, tidy=TRUE,fig.width=12, fig.height=8}
 data_covid %>% filter(iso3c %in% countries) %>% 
   group_by(iso3c,date) %>%
   summarise_at(vars(-Province_Re),funs(sum)) %>% filter(deaths > 4) %>%
   mutate(days_elapsed = date - min(date),
          end_label = ifelse(date == max(date),iso3c, NA)) %>%
   ggplot(mapping = aes(x = days_elapsed, y = deaths,label=end_label,
                        color = iso3c, alpha=iso3c,
                        group = iso3c)) + 
   geom_line(size = 0.8) +scale_alpha_manual(values=c(1,1,1,1,1,1,1,0.3,1))+
   geom_text_repel(nudge_x = 1.1,
                   nudge_y = 0.1, 
                   segment.color = NA) + 
   guides(color = FALSE,alpha=F) + 
   scale_color_manual(values = prismatic::clr_darken(paletteer_d("ggsci::category20_d3"), 0.2)) +
   scale_y_continuous(labels = scales::comma_format(accuracy = 1),
                      trans = "log2",n.breaks = 10) +  
   scale_x_continuous(n.breaks = 10) +
   labs(x = "Días desde el quinto deceso", 
        y = "Número acumulado de muertes (escala log2)", 
        title = "Número acumulado de muertes por COVID-19", 
        caption = "Juan Pablo Díaz @juandiazmart / Data: Repo John H.",
        subtitle = paste("Datos hasta", format(max(data_covid$date), "%b %e, %Y"))) + 
   theme(plot.title = element_text(size = rel(2), face = "bold"),
         plot.subtitle = element_text(size = rel(1.5)),
         axis.text.y = element_text(size = rel(2)),
         axis.title.x = element_text(size = rel(1.5)),
         axis.title.y = element_text(size = rel(1.5)),
         axis.text.x = element_text(size = rel(2)),
         legend.text = element_text(size = rel(2)),
         panel.grid.major = element_line(colour = "grey90", size = .1),
         panel.background = element_blank(),
         axis.line = element_line(colour = "grey50", size = .9)) + 
   geom_abline(intercept =log2(5), slope = 1/2,linetype = "dashed")+
   annotate("text", label = "Muertes incrementan \n al doble cada 2 días", x = 13, y = 1024,size=3)+
   geom_abline(intercept =log2(5), slope = 1/3,linetype = "dashed")+
   annotate("text", label = "Muertes incrementan \n al doble cada 3 días", x = 15, y = 64,size=3)
```

Estos datos son los que personalmente me preocupan ya que México podría llegar a 4,000 muertos aproximadamente 20 días después del quinto deceso si las muertes incremental al doble cada 2 días (mismo caso que España). Volvemos al punto central que discutí en los datos de casos confirmados, **lo importante es ver cuánto cambia la pendiente a través del tiempo**. Hay que tener en cuenta que muchas de las muertes no serán diagnosticadas como muertes por COVID-19 (eso pasa en México y en otros países), por eso mientras el aumento sea constante no habría de preocuparse por esta sub-estimación.


## Estimación del número de infectados y del impacto de Susana Distancia.

Debido a la naturaleza e importancia de la enfermedad, diferentes revistas indexadas en el mundo han acelerado su proceso de revisión para poder publicar diferentes artículos académicos referentes al SARS-COV 19. A mí siempre me han llamado la atención aquellos artículos que describen modelos de predicción. 

En la sección anterior mencioné que es mejor utilizar el número de muertes si queremos hacer algún tipo de comparación o inferencia. Algunas limitaciones de este número son:

1. Posible sub-estimación de muertes por COVID 19 - Esto debido a que habrá casos donde SARS-COV 19 no haya sido identificado.
2. Posible retraso en la captura de muertes - Hemos visto en algunas conferencias vespertinas casos donde la confirmación de SARS-COV 19 llega después del fallecimiento.

Estas limitaciones no afectarán ningún modelo o inferencia que se quiera realizar siempre y cuando ambas se mantengan constantes en el tiempo. 

¿De qué manera se puede estimar el número de infectados y el impacto de las medidas realizadas por el gobierno federal para incentivar el distanciamiento social? Utizando la historia natural de la enfermedad. El Imperial College de Reino Unido publicó el 30 de marzo un modelo [modelo de predicción](https://www.imperial.ac.uk/mrc-global-infectious-disease-analysis/covid-19/report-13-europe-npi-impact/) de muertes, infectados y efectos de diferentes medidas para "aplanar la curva". Con el fin de tener una mejor imagen de lo que pasa con COVID-19, el anterior modelo fue adaptado utilizando los datos oficiales reportados en nuestro país. La Figura 1 muestra el modelo de predicción.

```{r pressure, echo=FALSE, fig.cap="Modelo de predicción",fig.align="center"}
knitr::include_graphics("model.png")
```

El modelo utiliza las muertes observadas de acuerdo a los datos oficiales del gobierno de México.La Figura 1 muestra el nivel jerárquico (de abajo hacia arriba) que nos permite relacionar el impacto de diferentes intervenciones (i.e. cierre de escuelas,etc.) y las muertes observadas. Dada la relación que existe entre los diferentes parámetros a estimar, el modelo realiza la inferencia utilizando un enfoque Bayesiano mediante `stan`, un lenguaje de programación específco para inferencia Bayesiana. La relación entre los parámetros se explica a grandes razgos a continuación utilizando la misma notación que el modelo original.

### Muertes observadas

Día con día el gobierno federal nos infroma de el número de muertes observadas $D_t$ para los d+ias $t\in1,...,n$. Estas muertes diarias son modeladas utilizando el valor esperado de las muertes diarias, es decir, $d_t=\mathbf{E}[D_t]$. El modelo asume que $D_t$ tiene una distribución binomial negativa^[Asumo que utlizaron esta distribución para permitir la posible sobredispersión.] con los siguientes parámetros:

$$D_t\sim binomial \space neg \left(d_t,d_t+\frac{d_t^2}{\phi} \right)$$
$$\phi \sim N^+(0,5)$$
donde $\phi$ tiene una distribución normal truncada. El número esperado de muertes $d$ en un determinado día es una función del número de infecciones $c$ que ocurrieron en días previos. Para poder unir las muertes con los casos infectados, se utilizó la tasa de mortalidad por infección ($ifr$, infection mortality rate en inglés) que toma en cuenta tanto a los detectados como los no detectados^[recordemos que la tasa de letalidad solo contempla a los detectados mientras la tasa de mortalidad por infección contempla a todas las personas infectadas] y el tiempo que pasa entre la infección y la muerte, la cual denotamos con $\pi$. Si bien no hay un dato para México hasta el momento para $ifr$, se utilizó la tasa de mortalidad por infección reportado en el mismo estudio. Este valor correspondió a 0.9%.

El modelo asume (basado en [evidencia](https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(20)30243-7/fulltext) previa) que $\pi$ es una suma de dos tiempos independientes: el tiempo de incubación(tiempo entre infección y sintomas) y el tiempo entre síntomas y muerte. Claramente estos tiempos son aleatorios y por lo tanto se les asigna una distribución de probabilidad (Gamma^[Parametrizada con la media de la distribución y su coeficiente de variación]). Por lo tanto $\pi$ está dado por:

$$\phi\sim ifr*((Gamma(5.1,0.86)+Gamma(18.8,0.45))$$
Ahora que ya sabemos que $\pi$ representa la distribución entre el tiempo de infección y muerte ajustada por la tasa de mortalidad por infección, se puede relacionar el número esperado de muertes en un determinado día $d_t$ con $pi$ de la siguiente manera:

$$d_t=\sum_{\tau=0}^{t-1} c_t\pi_{t-\tau}$$
donde $c_\tau$ es el número de nuevas infecciones en el día $\tau$ y donde $\pi$ es discretizado. La ecuación anterior nos dice que el número de muertes esperadas al día $t$ puede ser expresado como la ponderación entre el número de infecciones en días pasados y la probabilidad de morir.

### Infecciones en el modelo

Hasta ahora he resumido la relación que puede existir entre el número de muertes y el número de infecciones al día $t$. Para modelar el número de infecciones en el tiempo es necesario especificar el tiempo que pasa entre el inicio de síntomas de una persona y el inicio de síntomas de otra persona infectada por la primera (en inglés se conoce como **serial interval**). De acuerdo a la literatura el promedio de este tiempo ronda entre los 4 días y 8 días, por lo que el modelo asume que éste tiene una distribución gamma^[Misma parametrización] con los siguientes parámetros:

$$ g(\tau) \sim Gamma(6.5,0.62)$$
El número de infecciones $c_t$ al día $t$ está dada por la siguiente [función](https://www.jstor.org/stable/1969779?seq=1):

$$c_t=R_t\sum_{\tau=0}^{t-1} c_\tau g_{t-\tau}$$
donge $g$ también es discretizada. Lo anterior implica que las infecciones al dia de hoy dependen de las infecciones en días pasados, ponderadas por la distribución $g$. Esta ponderación es ajustada por el numero efectivo de reproducción
^[Este es el número de casos, en promedio, que van a ser causados por una persona infectada durante el periodo de contagio] $R_t$. Éste número cambia con respecto al tiempo debido a que la implimentación de diferentes medidas de mitigación en teoría hará que éste disminuya y por lo tanto haya menos contagios.

La idea es empezar con un número de reproduciión basal $R_0$^[Para los que vieron Contagio seguro recordarán que esta expresión es conocida como el número básico de reproducción (R-naught en inglés)] y que este se irá modificando en el tiempo debido a la implementación de diferentes intervenciones como Susana Distancia en nuestro país.

El modelo utiliza las siguientes intervenciones:

1. Aislación voluntaria al ser detectado con SARS-COV2 - Se asume que esta medida fue implementada unos días después del primer caso confirmado con COVID-19 (28 de febrero). Decidimos utilizar el 3 de marzo como el tiempo en que se implementa la medida para dar tiempo a que ésta medida fuera difundida en todo el país cuando se presentaron los primeros casos.

2. Cancelación de eventos públicos - Se asume como el día (Marzo 17) en que el gobierno de la CDMX decidió cancelar todos los eventos públicos en la [ciudad](https://www.eluniversal.com.mx/metropoli/cdmx/coronavirus-gobierno-de-cdmx-suspende-eventos-masivos-por-covid-19).

3. Cierre de escuelas - Se asume como el día (Marzo 21) en que la UNAM suspendió clases [clases](https://heraldodemexico.com.mx/pais/unam-suspende-clases-por-coronavirus-covid-19/). 

4. Exhortación al distanciamiento social - Inicio de Susana [Distancia](https://www.unotv.com/noticias/portal/nacional/detalle/coronavirus-en-mexico-anuncian-jornada-nacional-de-sana-distancia-491479/) (Marzo 23).

Para falicitar la estimación de $R_t$, se utiliza una función por partes que modifique $R_t$a partir de un valor inical $R_0$ y ademas que el efecto de cada intervención  es multiplicativa. Por lo tanto el número efectivo de reproducción $R_t$  es una función de la implementación de cada intervención al día $t$:

$$R_t=R_0exp(-\sum_{k=1}^{4}\alpha_{k}I_{k,t})$$

donde I es una variable indicadora donde toma el valor de 1 si la intervención $k$ es implementada $k=1,...,4$ y 0 si no. Asimsmo:

$$\alpha_{k}\sim Gamma(.5,1)$$
La distribución de $R_0$ fue asumida con base en la evidencia [previa](https://www.ncbi.nlm.nih.gov/pubmed/32097725):

$$R_0\sim Normal(2.4,|\kappa|),\space \kappa\sim Normal(0,0.5)$$
Finalmente el modelo asume que las nuevas infecciones ocurren 30 días antes de que el país haya acumulado 10 muertes observadas.

## Resultados

El modelo estima que para `r format(max(data_covid$date), "%b %e")`, el número acumulado de infectados por SARS-COV2 en nuestro país es de `r formatC(tail(data_country[,"predicted_cases_c"],1), format="f", big.mark=",", digits=0)` (95% CrI: `r paste(formatC(tail(data_country[,"predicted_min_c"],1), format="f", big.mark=",", digits=0),"-",formatC(tail(data_country[,"predicted_max_c"],1), format="f", big.mark=",", digits=0))`) (ver Figura XX). Lo anterior representa al `r percent(tail(data_country[,"predicted_cases_c"],1)/pop)` (95% CrI: `r paste(percent(tail(data_country[,"predicted_min_c"],1)/pop),"-",percent(tail(data_country[,"predicted_max_c"],1)/pop))`) de la población total en nuestro país, utilizando los datos de CONAPO para 2020 (127 millones de mexicanos aproximadamente).

Al inicio de la epidemia en México, el número efectivo de reproducción $R_t$ era de `r formatC(head(data_country[,"rt"],1), format="f", big.mark=",", digits=1)` (95% CrI: `r paste(formatC(head(data_country[,"rt_min"],1), format="f", big.mark=",", digits=1),"-",formatC(head(data_country[,"rt_max"],1), format="f", big.mark=",", digits=1))`). Después de que el gobierno implementó "Susana Distancia" el 23 de Marzo, éste descendió a `r formatC(tail(data_country[,"rt"],1), format="f", big.mark=",", digits=1)` (95% CrI: `r paste(formatC(tail(data_country[,"rt_min"],1), format="f", big.mark=",", digits=1),"-",formatC(tail(data_country[,"rt_max"],1), format="f", big.mark=",", digits=1))`)

```{r message=FALSE, warning=FALSE, tidy=TRUE,fig.width=12, fig.height=6,fig.cap="Número acumulado de confirmados por COVID-19, observados y predichos"}
p1<-p1+labs(caption = "Juan Pablo Díaz @juandiazmart / Data: https://github.com/mariorz.",
        subtitle = paste("Datos hasta", format(max(data_covid$date), "%b %e, %Y"))) + 
   theme(plot.title = element_text(face = "bold"),
         panel.grid.major = element_line(colour = "white", size = .1),
         panel.background = element_blank(),
         axis.line = element_line(colour = "grey50", size = .9))


ggplotly(p1) %>% 
 layout(annotations = 
 list(x = 1, y =0, text ="Juan Pablo Díaz @juandiazmart / Data: Repo John H.", 
      showarrow = F, xref='paper', yref='paper', 
      xanchor='right', yanchor='auto', xshift=0, yshift=0,
      font=list(size=7)),legend = list(orientation = 'h')
 )
```


```{r message=FALSE, warning=FALSE, tidy=TRUE,fig.width=10,preview=TRUE, fig.height=8,fig.width=12,fig.cap=paste("Efecto de las intervenciones en",expression(R[t]))}
p3+labs(caption = "Juan Pablo Díaz @juandiazmart / Data: https://github.com/mariorz.",
        subtitle = paste("Datos hasta", format(max(data_covid$date), "%b %e, %Y"))) + 
   theme(plot.title = element_text(size = rel(2), face = "bold"),
         plot.subtitle = element_text(size = rel(1.5)),
         axis.text.y = element_text(size = rel(2)),
         axis.title.x = element_text(size = rel(1.5)),
         axis.title.y = element_text(size = rel(1.5)),
         axis.text.x = element_text(size = rel(2)),
         legend.text = element_text(size = rel(1)),
         panel.grid.major = element_line(colour = "grey90", size = .1),
         panel.background = element_blank(),
         axis.line = element_line(colour = "grey50", size = .9))
```

Una de las ventajas de este modelo es que nos permite hacer predicciones del número acumulado de muertes, utilizando $R_t$ estimado en `r format(max(data_covid$date), "%b %e")` y su contrafactual^[Lo que pudo haber ocurrido] ($R_t$ al inicio de la epidemia en nuestro país);estas predicciones se muestran en la Figura XX. Con estos resultados es posible estimar cuantas muertes se han evitado hasta el día de hoy, lo anterior se obtiene al calcular la diferencia entre ambas predicciones (region azul menos región roja de la Fiugra XX en`r format(max(data_covid$date), "%b %e")`). Gracias a las medidas de mitigación se han podido evitar 
 `r formatC(muertes_evitadas[1], format="f", big.mark=",", digits=0)` (95% CrI: `r paste(formatC(muertes_evitadas[2], format="f", big.mark=",", digits=0),"-",formatC(muertes_evitadas[3], format="f", big.mark=",", digits=0))`) muertes.

```{r message=FALSE, warning=FALSE, tidy=TRUE,fig.width=12, fig.height=6,fig.cap= "Número acumulado de muertes por COVID-19, observados y predichos"}
p2<-p2+labs(caption = "Juan Pablo Díaz @juandiazmart / Data: https://github.com/mariorz.",
        subtitle = paste("Datos hasta", format(max(data_covid$date), "%b %e, %Y"))) + 
  theme(plot.title = element_text(face = "bold"),
         panel.grid.major = element_line(colour = "white", size = .1),
         panel.background = element_blank(),
         axis.line = element_line(colour = "grey50", size = .9))

ggplotly(p2) %>% 
 layout(annotations = 
 list(x = 1, y =0, text ="Juan Pablo Díaz @juandiazmart / Data: Repo John H.", 
      showarrow = F, xref='paper', yref='paper', 
      xanchor='right', yanchor='auto', xshift=0, yshift=0,
      font=list(size=7))
 )
```
